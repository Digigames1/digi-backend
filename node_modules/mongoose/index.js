import mongodb from 'mongodb';

const { MongoClient } = mongodb;
let client;

export async function connect(uri, options = {}) {
  client = new MongoClient(uri, options);
  await client.connect();
  return client;
}

export class Schema {
  constructor(definition) {
    this.definition = definition;
  }
}

export function model(name, schema) {
  const collectionName = name.toLowerCase();
  return {
    create: (doc) => {
      if (!client) throw new Error('MongoClient not connected');
      const collection = client.db().collection(collectionName);
      return collection.insertOne(doc);
    },
    findOneAndUpdate: (filter, update) => {
      if (!client) throw new Error('MongoClient not connected');
      const collection = client.db().collection(collectionName);
      return collection.findOneAndUpdate(filter, { $set: update });
    }
  };
}

export default { connect, Schema, model };
