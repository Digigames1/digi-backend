<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <div class="container header-flex">
      <a href="/" class="logo">
        <img src="/icons/no_padding.png" alt="DigiGames Logo" />
      </a>
      <select id="langSelector" style="margin-left: auto;">
        <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
        <option value="en">English</option>
      </select>
      <select id="currencySelector" style="margin-left: 1rem;">
        <option value="USD">$ USD</option>
        <option value="EUR">‚Ç¨ EUR</option>
        <option value="UAH">‚Ç¥ UAH</option>
        <option value="PLN">z≈Ç PLN</option>
        <option value="AUD">A$ AUD</option>
        <option value="CAD">C$ CAD</option>
      </select>
    </div>
  </header>

  <main class="container" style="text-align:center;">
    <h1 class="section-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
    <div style="margin-top: 1rem;">
      <p><strong>–°—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</strong> <span id="order-total">$0.00</span></p>
    </div>

    <form id="checkoutForm" style="margin-top: 1rem;">
      <label for="name">–í–∞—à–µ —ñ–º‚Äô—è:</label>
      <input type="text" id="name" placeholder="–í–∞—à–µ —ñ–º‚Äô—è" required />
      <label for="email">Email:</label>
      <input type="email" id="email" placeholder="Email" required />
      <button type="submit">Go to checkout</button>
    </form>
  </main>

  <footer>
    <div class="footer-links">
      <a href="/about.html">About Us</a>
      <a href="/contacts.html">Contacts</a>
      <a href="/partnership.html">Partnership</a>
    </div>
    <p style="text-align:center; margin-top: 0.5rem;">&copy; 2025 DigiGames</p>
  </footer>

  <script>
    const currencySymbols = {
      USD: "$", EUR: "‚Ç¨", UAH: "‚Ç¥", PLN: "z≈Ç", AUD: "A$", CAD: "C$"
    };

    let currentCurrency = localStorage.getItem("currency") || "USD";
    let cartTotal = sessionStorage.getItem("cartTotal") || "0.00";

    const totalEl = document.getElementById("order-total");
    const currencySelect = document.getElementById("currencySelector");

    document.addEventListener("DOMContentLoaded", () => {
      // üí± –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—É–º—É
      if (totalEl) totalEl.innerText = cartTotal;

      // üí≤ –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∞–ª—é—Ç—É
      if (currencySelect) {
        currencySelect.value = currentCurrency;
        currencySelect.addEventListener("change", (e) => {
          currentCurrency = e.target.value;
          localStorage.setItem("currency", currentCurrency);
          location.reload(); // –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏
        });
      }

      // üì® –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
      document.getElementById("checkoutForm").addEventListener("submit", async function(e) {
        e.preventDefault();

        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const price = parseFloat(cartTotal.replace(/[^\d.]/g, "")) || 0;

        if (!name || !email || price === 0) {
          alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è.");
          return;
        }

        const payload = {
          productId: "manual",
          name,
          email,
          price,
          quantity: 1
        };

        try {
          const res = await fetch("/api/order", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });

          const result = await res.json();

          if (res.ok && result.liqpay) {
            // –í–∏–¥–∞–ª—è—î–º–æ —Å—É–º—É –∑ —Å–µ—Å—ñ—ó —Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ LiqPay
            sessionStorage.removeItem("cartTotal");

            const form = document.createElement("form");
            form.method = "POST";
            form.action = "https://www.liqpay.ua/api/3/checkout";
            form.acceptCharset = "utf-8";

            const dataInput = document.createElement("input");
            dataInput.type = "hidden";
            dataInput.name = "data";
            dataInput.value = result.liqpay.data;
            form.appendChild(dataInput);

            const signatureInput = document.createElement("input");
            signatureInput.type = "hidden";
            signatureInput.name = "signature";
            signatureInput.value = result.liqpay.signature;
            form.appendChild(signatureInput);

            document.body.appendChild(form);
            form.submit();
          } else {
            alert("‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è");
          }
        } catch (err) {
          alert("‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î: " + err.message);
        }
      });
    });
  </script>
</body>
</html>



